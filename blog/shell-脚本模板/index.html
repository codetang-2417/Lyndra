<!DOCTYPE html><html lang="zh-cn"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.png"><meta name="generator" content="Astro v5.7.13"><!-- Canonical URL --><link rel="canonical" href="https://www.hysling.top/blog/shell-%E8%84%9A%E6%9C%AC%E6%A8%A1%E6%9D%BF"><link rel="alternate" type="application/rss+xml" title="Lyndra's Blog" href="/rss.xml"><!-- Primary Meta Tags --><meta name="title" content="Shell 脚本模板 - Lyndra's Blog"><meta name="description" content="素处以默"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://www.hysling.top/blog/shell-%E8%84%9A%E6%9C%AC%E6%A8%A1%E6%9D%BF"><meta property="og:title" content="Shell 脚本模板 - Lyndra's Blog"><meta property="og:description" content="素处以默"><meta property="og:image" content="https://www.hysling.top/blog/shell-%E8%84%9A%E6%9C%AC%E6%A8%A1%E6%9D%BF"><!-- <meta property="og:image:alt" content={site.description}/> --><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://www.hysling.top/blog/shell-%E8%84%9A%E6%9C%AC%E6%A8%A1%E6%9D%BF"><meta property="twitter:title" content="Shell 脚本模板 - Lyndra's Blog"><meta property="twitter:description" content="素处以默"><meta property="twitter:image" content="https://www.hysling.top/blog/shell-%E8%84%9A%E6%9C%AC%E6%A8%A1%E6%9D%BF"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="sitemap" href="/sitemap-0.xml"><title>Shell 脚本模板 - Lyndra&#39;s Blog</title><script src="/toggle-theme.js"></script><script async type="text/javascript" src="/load-mathjax.js"></script><script async type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/mermaid/10.9.0/mermaid.min.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><link rel="stylesheet" href="/_astro/WalineComment.XaQ6XQsx.css">
<link rel="stylesheet" href="/_astro/BlogPost.BUYUBhIy.css">
<link rel="stylesheet" href="/_astro/about.gIe6_up2.css">
<link rel="stylesheet" href="/_astro/_slug_.DYqrg3Zi.css">
<style>#donate-item-img{filter:grayscale(1)}#donate-item-img:hover{filter:blur(0px);cursor:pointer}.esa-sponsor{position:relative;width:100%;margin:40px 0}.esa-sponsor .qrshow{position:absolute;width:200px;height:200px;cursor:pointer;left:calc(50% - 100px);top:-170px;z-index:999;display:none;box-shadow:0 1px 15px #1b1f2326,0 0 1px #6a737d59}
.post-title[data-astro-cid-6t6zfk7k]:hover{outline:0;color:#cc7a00;text-shadow:1px 1px 1px #ffd147}.toc_container[data-astro-cid-6t6zfk7k]{overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.toc_container[data-astro-cid-6t6zfk7k]::-webkit-scrollbar{width:0;height:0}.toc_container[data-astro-cid-6t6zfk7k] a[data-astro-cid-6t6zfk7k]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}
</style></head><body class="bg-skin-secondary"> <header class="fixed top-0 w-full bg-skin-fill text-skin-base z-10"> <div class="flex items-center justify-between container"> <div class="block xl:hidden"> <button type="button" id="menu-icon" class="header-btn" title="Menu"> <i class="ri-menu-fill"></i> </button> <button type="button" id="menu-icon-close" class="header-btn hidden" title="Menu"> <i class="ri-close-fill"></i> </button> <script type="module">let n=document.getElementById("menu-icon"),t=document.getElementById("menu-icon-close"),l=document.getElementById("mobile-menu"),e=document.getElementById("aside-btn"),i=document.getElementById("aside-close-btn"),s=document.getElementById("personal-info");n.addEventListener("click",()=>{e&&e.classList.contains("hidden")&&d([e,i,s]),d([n,t,l])});t.addEventListener("click",()=>{d([n,t,l])});function d(o){o.forEach(c=>{c.classList.toggle("hidden")})}</script> </div> <a class="text-2xl p-4" href="/">Lyndra&#39;s Blog</a> <div class="flex items-center"> <div class="hidden xl:block"> <div class="flex items-center space-x-5 pr-4"> <div class="box relative h-10 w-auto flex items-center" data-astro-cid-eimmu3lg> <a href="/blog/1" target="_self" class="header-link-active hover:header-link-hover" data-astro-cid-eimmu3lg> <i class="ri-draft-line" data-astro-cid-eimmu3lg></i> 博客  </a>  </div> <div class="box relative h-10 w-auto flex items-center" data-astro-cid-eimmu3lg> <a href="/feed/1" target="_self" class="hover:header-link-hover" data-astro-cid-eimmu3lg> <i class="ri-lightbulb-flash-line" data-astro-cid-eimmu3lg></i> 动态  </a>  </div> <div class="box relative h-10 w-auto flex items-center" data-astro-cid-eimmu3lg> <a href="/archive/1" target="_self" class="hover:header-link-hover" data-astro-cid-eimmu3lg> <i class="ri-archive-line" data-astro-cid-eimmu3lg></i> 归档  </a>  </div> <div class="box relative h-10 w-auto flex items-center" data-astro-cid-eimmu3lg> <a href="/message" target="_self" class="hover:header-link-hover" data-astro-cid-eimmu3lg> <i class="ri-chat-1-line" data-astro-cid-eimmu3lg></i> 留言  </a>  </div> <div class="box relative h-10 w-auto flex items-center" data-astro-cid-eimmu3lg> <a href="/search" target="_self" class="hover:header-link-hover" data-astro-cid-eimmu3lg> <i class="ri-search-line" data-astro-cid-eimmu3lg></i> 搜索  </a>  </div> <div class="box relative h-10 w-auto flex items-center" data-astro-cid-eimmu3lg> <a href="javascript:void(0);" target="_self" class="hover:header-link-hover" data-astro-cid-eimmu3lg> <i class="ri-more-fill" data-astro-cid-eimmu3lg></i> 更多 <i class="ri-arrow-down-s-line" data-astro-cid-eimmu3lg></i> </a> <div class="dropdown cursor-pointer border rounded bg-skin-fill p-4" data-astro-cid-eimmu3lg> <ul class="space-y-4 w-28" data-astro-cid-eimmu3lg> <li class="text-center hover:text-skin-active select-none" data-astro-cid-eimmu3lg> <i class="ri-information-line" data-astro-cid-eimmu3lg></i> <a target="_self" href="/about" data-astro-cid-eimmu3lg>关于本站</a> </li><li class="text-center hover:text-skin-active select-none" data-astro-cid-eimmu3lg> <i class="ri-user-5-line" data-astro-cid-eimmu3lg></i> <a target="_self" href="/friends" data-astro-cid-eimmu3lg>友情链接</a> </li> </ul> </div> </div>  </div> </div> <button type="button" id="theme-btn" class="header-btn" title="Toggles light & dark" aria-label="auto" aria-live="polite"> <i id="moon-icon" class="ri-sun-line"></i> <i id="sun-icon" class="ri-moon-line"></i> </button> <div class="block xl:hidden"> <button type="button" id="aside-btn" class="header-btn" title="Open Aside Bar" aria-label="auto" aria-live="polite"> <i class="ri-user-line"></i> </button> <button type="button" id="aside-close-btn" class="header-btn hidden" title="Close Aside Bar" aria-label="auto" aria-live="polite"> <i class="ri-close-fill"></i> </button> <div id="blog-aside" class="absolute top-16 bg-skin-fill right-0 blog-aside hidden"></div> <script type="module">let n=document.getElementById("aside-btn"),t=document.getElementById("aside-close-btn"),e=document.getElementById("menu-icon"),i=document.getElementById("menu-icon-close"),s=document.getElementById("mobile-menu"),l=document.getElementById("personal-info");n.addEventListener("click",()=>{e&&e.classList.contains("hidden")&&d([e,i,s]),d([n,t,l])});t.addEventListener("click",()=>{d([t,l,n])});function d(o){o.forEach(c=>{c.classList.toggle("hidden")})}</script> </div> </div> </div> <div id="mobile-menu" class="hidden text-center overflow-y-auto pb-8" style="height: calc(100vh - 64px)"> <div class="py-2"> <a class=" hover:text-skin-active" href="/blog/1"> <i class="ri-draft-line"></i> <span>博客</span> </a>  <div class="space-y-4 text-sm">  </div> </div><div class="py-2"> <a class=" hover:text-skin-active" href="/feed/1"> <i class="ri-lightbulb-flash-line"></i> <span>动态</span> </a>  <div class="space-y-4 text-sm">  </div> </div><div class="py-2"> <a class=" hover:text-skin-active" href="/archive/1"> <i class="ri-archive-line"></i> <span>归档</span> </a>  <div class="space-y-4 text-sm">  </div> </div><div class="py-2"> <a class=" hover:text-skin-active" href="/message"> <i class="ri-chat-1-line"></i> <span>留言</span> </a>  <div class="space-y-4 text-sm">  </div> </div><div class="py-2"> <a class=" hover:text-skin-active" href="/search"> <i class="ri-search-line"></i> <span>搜索</span> </a>  <div class="space-y-4 text-sm">  </div> </div><div class="py-2"> <a class=" hover:text-skin-active" href="javascript:void(0);"> <i class="ri-more-fill"></i> <span>更多</span> </a> <div class="divider-horizontal"></div> <div class="space-y-4 text-sm"> <a class="block hover:text-skin-active" href="/about"> <i class="ri-information-line"></i> <span>关于本站</span> </a><a class="block hover:text-skin-active" href="/friends"> <i class="ri-user-5-line"></i> <span>友情链接</span> </a> </div> </div> </div> <div id="personal-info" class="hidden break-all overflow-y-auto pb-8" style="height: calc(100vh - 64px)"> <img class="avatar my-4 mx-auto" src="/avatar.svg" alt="avatar"> <div class="mb-2 text-center">本来无一物，何处惹尘埃</div> <div class="flex items-center justify-center flex-wrap"> <a title="github" href="https://github.com/codetang-2417" target="_blank"> <i class="ri-github-fill text-2xl mr-2 cursor-pointer"></i> </a><a title="rss" href target="_blank"> <i class="ri-rss-fill text-2xl mr-2 cursor-pointer"></i> </a> </div> <div class="divider-horizontal-mini"></div> <div class="text-center"> <div> <i class="ri-folder-3-line menu-icon"></i>分类 </div> <div class="my-2 break-all truncate"> <a class="hover:text-skin-active" title="工具教程 (16)" href="/category/工具教程"> 工具教程 (16) </a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active" title="专业知识 (4)" href="/category/专业知识"> 专业知识 (4) </a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active" title="编程开发 (8)" href="/category/编程开发"> 编程开发 (8) </a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active" title="系统维护 (21)" href="/category/系统维护"> 系统维护 (21) </a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active" title="网络安全 (7)" href="/category/网络安全"> 网络安全 (7) </a> </div> <div class="divider-horizontal-mini"></div>
          <div class="text-center"> <i class="ri-price-tag-3-line menu-icon"></i> 标签 </div> <div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="AI" href="/tags/AI">AI (1)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="iPhone" href="/tags/iPhone">iPhone (2)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Performance" href="/tags/Performance">Performance (1)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Linux" href="/tags/Linux">Linux (17)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Manjaro" href="/tags/Manjaro">Manjaro (8)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Bash" href="/tags/Bash">Bash (2)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Server" href="/tags/Server">Server (8)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Network" href="/tags/Network">Network (4)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Hardware" href="/tags/Hardware">Hardware (1)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Astro" href="/tags/Astro">Astro (2)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Github" href="/tags/Github">Github (1)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Blog" href="/tags/Blog">Blog (3)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Siyuan" href="/tags/Siyuan">Siyuan (1)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Archlinux" href="/tags/Archlinux">Archlinux (2)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Shell" href="/tags/Shell">Shell (1)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Downgrade" href="/tags/Downgrade">Downgrade (1)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Cursor" href="/tags/Cursor">Cursor (1)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Git" href="/tags/Git">Git (1)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Ubuntu" href="/tags/Ubuntu">Ubuntu (6)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Markdown" href="/tags/Markdown">Markdown (1)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Hugo" href="/tags/Hugo">Hugo (1)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Github pages" href="/tags/Github pages">Github pages (1)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Algorithm" href="/tags/Algorithm">Algorithm (3)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Docker" href="/tags/Docker">Docker (5)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="VPS" href="/tags/VPS">VPS (3)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="Proxy" href="/tags/Proxy">Proxy (4)</a> </div><div class="my-2 break-all truncate"> <a class="hover:text-skin-active my-2" title="QEMU" href="/tags/QEMU">QEMU (3)</a> </div> </div> </div> </header> <main class="container p-4  pt-20 text-skin-base min-h-full pb-32 relative" id="app"> <div class="grid grid-cols-4 gap-8"> <div class="col-span-4 xl:col-span-3 space-y-4 first:space-y-2"> <button class="flex items-center text-md cursor-pointer hover:text-skin-active outline-none" style="background-color: inherit;" onclick="history.back()"> <i class="ri-arrow-left-line mr-2"></i> <span>返回</span> </button>  <div> <div> <!-- title --> <h1 class="break-all text-2xl font-bold">Shell 脚本模板</h1> <div class="flex flex-wrap items-center my-2 text-skin-dodge"> <!-- date --> <div class="mr-2"><i class="ri-calendar-2-fill mr-1"></i>2025-02-28</div> <!-- draft -->  <!-- category --> <a href="/category/编程开发" class="text-wrap break-all hover:text-skin-active mr-2"><i class="ri-folder-3-line mr-1"></i>编程开发</a><a href="/category/系统维护" class="text-wrap break-all hover:text-skin-active mr-2"><i class="ri-folder-3-line mr-1"></i>系统维护</a> <!-- tag --> <a href="/tags/Linux" class="text-wrap break-all hover:text-skin-active mr-2"><i class="ri-hashtag mr-1"></i>Linux</a><a href="/tags/Archlinux" class="text-wrap break-all hover:text-skin-active mr-2"><i class="ri-hashtag mr-1"></i>Archlinux</a><a href="/tags/Shell" class="text-wrap break-all hover:text-skin-active mr-2"><i class="ri-hashtag mr-1"></i>Shell</a> <!-- update --> <!--{--> <!--  lastModified && (--> <!--    <div class="mr-2"><i class="ri-calendar-check-fill "></i>{t('post.lastUpdated')}:{lastModified}</div>--> <!--  )--> <!--}--> <!-- minutes --> <div class="mr-2 flex items-center"><i class="ri-hourglass-fill mr-1"></i>9分钟</div>
        <div class="mr-2 flex items-center"><i class="ri-quill-pen-line mr-1"></i>1758字</div> </div>  </div> <div class="divider-horizontal"></div> <article class="markdown-body"> <h1 id="shell-脚本模板">Shell 脚本模板</h1>
<p>在日常的开发工作中，我们经常需要编写一些脚本，来完成一些自动化工作，同时还能保存一些环境使用的配置。可以在一段时间后，仍然能保证快速地回忆和使用。</p>
<p>但每一个脚本有可能需要传递命令行参数，如果为每一个脚本都撰写一套命令行解析，会比较麻烦，浪费时间。但不进行命令行参数解析，又会导致后续使用不便，一段时间后就不记得怎么使用了。</p>
<h2 id="模板">模板</h2>
<p>先给出模板代码。这个脚本模板采用模块化设计，每个模块都有独立的函数，方便管理和调用。每一个功能由单独的选项来调用，方便记忆和使用。</p>
<p>可以在一个脚本中整合多个功能，利用统一的命令行参数处理框架，不需要为单个功能编写脚本单独处理参数。</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.r9qfg.css"><script type="module" src="/_astro/ec.dy9ns.js"></script><figure class="frame has-title" style="--lnWidth:3ch"><figcaption class="header"><span class="title">Shell_script_template.sh</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="gutter"><div class="ln">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">#!/usr/bin/env bash</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">2</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">#!/usr/bin/env bash</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">3</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">#==================================================================</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">4</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># ██╗  ██╗   ██╗███╗   ██╗██████╗ ██████╗  █████╗</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">5</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># ██║  ╚██╗ ██╔╝████╗  ██║██╔══██╗██╔══██╗██╔══██╗</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">6</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># ██║   ╚████╔╝ ██╔██╗ ██║██║  ██║██████╔╝███████║</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">7</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># ██║    ╚██╔╝  ██║╚██╗██║██║  ██║██╔══██╗██╔══██║</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">8</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># ███████╗██║   ██║ ╚████║██████╔╝██║  ██║██║  ██║</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">9</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># ╚══════╝╚═╝   ╚═╝  ╚═══╝╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">10</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">#==================================================================</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">11</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">#</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">12</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 文件名称: 脚本模板.sh</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">13</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 文件描述: 一个通用的 Shell 脚本模板，提供命令行参数处理、日志输出等基础功能</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">14</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">#</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">15</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 作者: Lyndra &#x3C;lyndra.hyst@gmail.com></span></div></div><details class="ec-section"><summary><div class="ec-line"><div class="gutter"><div class="ln"></div></div><div class="code"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 16 16" width="16" height="16"><path d="m8.177.677 2.896 2.896a.25.25 0 0 1-.177.427H8.75v1.25a.75.75 0 0 1-1.5 0V4H5.104a.25.25 0 0 1-.177-.427L7.823.677a.25.25 0 0 1 .354 0ZM7.25 10.75a.75.75 0 0 1 1.5 0V12h2.146a.25.25 0 0 1 .177.427l-2.896 2.896a.25.25 0 0 1-.354 0l-2.896-2.896A.25.25 0 0 1 5.104 12H7.25v-1.25Zm-5-2a.75.75 0 0 0 0-1.5h-.5a.75.75 0 0 0 0 1.5h.5ZM6 8a.75.75 0 0 1-.75.75h-.5a.75.75 0 0 1 0-1.5h.5A.75.75 0 0 1 6 8Zm2.25.75a.75.75 0 0 0 0-1.5h-.5a.75.75 0 0 0 0 1.5h.5ZM12 8a.75.75 0 0 1-.75.75h-.5a.75.75 0 0 1 0-1.5h.5A.75.75 0 0 1 12 8Zm2.25.75a.75.75 0 0 0 0-1.5h-.5a.75.75 0 0 0 0 1.5h.5Z"></path></svg>197 collapsed lines</div></div></summary><div class="ec-line"><div class="gutter"><div class="ln">16</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 版本: 1.0.0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">17</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 创建日期: 2025-02-28</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">18</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 最后修改: 2025-02-28</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">19</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">#</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">20</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 使用许可: GPLv2 or other licenses</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">21</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># Copyright (c) 2025 Lyndra</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">22</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">#</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">23</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">#==================================================================</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">24</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">25</div></div><div class="code"><span style="--0:#79B8FF;--1:#005CC5">set</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-eo</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">pipefail</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">26</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">27</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 颜色配置</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">28</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">RED</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">'\033[0;31m'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">29</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">GREEN</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">'\033[0;32m'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">30</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">'\033[1;33m'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">31</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">'\033[0m'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">32</div></div><div class="code">
</div></div><div class="ec-line highlight mark"><div class="gutter"><div class="ln">33</div></div><div class="code"><span style="--0:#afb5b9;--1:#4d545b"># 命令配置，格式为：[命令名]="描述::处理函数::选项声明1::选项声明2::..."</span></div></div><div class="ec-line highlight mark"><div class="gutter"><div class="ln">34</div></div><div class="code"><span style="--0:#fb99a3;--1:#982934">declare</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#004fa9">-A</span><span style="--0:#E1E4E8;--1:#24292E"> COMMAND_MAP</span><span style="--0:#fb99a3;--1:#982934">=</span><span style="--0:#E1E4E8;--1:#24292E">(</span></div></div><div class="ec-line highlight mark"><div class="gutter"><div class="ln">35</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">[</span><span style="--0:#c2a8f3;--1:#613aa9">"install"</span><span style="--0:#E1E4E8;--1:#24292E">]=</span><span style="--0:#9ECBFF;--1:#032F62">"安装软件包::handle_install::-p,--package:指定包名（必须）"</span></div></div><div class="ec-line highlight mark"><div class="gutter"><div class="ln">36</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">[</span><span style="--0:#c2a8f3;--1:#613aa9">"remove"</span><span style="--0:#E1E4E8;--1:#24292E">]=</span><span style="--0:#9ECBFF;--1:#032F62">"移除软件包::handle_remove::-p,--package:指定包名（必须）"</span></div></div><div class="ec-line highlight mark"><div class="gutter"><div class="ln">37</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">[</span><span style="--0:#c2a8f3;--1:#613aa9">"backup"</span><span style="--0:#E1E4E8;--1:#24292E">]=</span><span style="--0:#9ECBFF;--1:#032F62">"执行备份::handle_backup::-s,--src:源目录（必须）::-d,--dest:目标目录（默认：/backups）"</span></div></div><div class="ec-line highlight mark"><div class="gutter"><div class="ln">38</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">39</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">40</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 错误处理函数</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">41</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">panic</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">42</div></div><div class="code"><span class="indent">  </span><span style="--0:#79B8FF;--1:#005CC5">echo</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-e</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">RED</span><span style="--0:#9ECBFF;--1:#032F62">}[错误]${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">} </span><span style="--0:#79B8FF;--1:#005CC5">$1</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">>&#x26;2</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">43</div></div><div class="code"><span class="indent">  </span><span style="--0:#79B8FF;--1:#005CC5">exit</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">1</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">44</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">45</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">46</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 日志输出函数</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">47</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">log_info</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">48</div></div><div class="code"><span class="indent">  </span><span style="--0:#79B8FF;--1:#005CC5">echo</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-e</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">GREEN</span><span style="--0:#9ECBFF;--1:#032F62">}[信息]${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">} </span><span style="--0:#79B8FF;--1:#005CC5">$1</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">>&#x26;2</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">49</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">50</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">51</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">log_warning</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">52</div></div><div class="code"><span class="indent">  </span><span style="--0:#79B8FF;--1:#005CC5">echo</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-e</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#9ECBFF;--1:#032F62">}[警告]${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">} </span><span style="--0:#79B8FF;--1:#005CC5">$1</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">>&#x26;2</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">53</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">54</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">55</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">log_success</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">56</div></div><div class="code"><span class="indent">  </span><span style="--0:#79B8FF;--1:#005CC5">echo</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-e</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">GREEN</span><span style="--0:#9ECBFF;--1:#032F62">}[成功]${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">} </span><span style="--0:#79B8FF;--1:#005CC5">$1</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">>&#x26;2</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">57</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">58</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">59</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">##############################################</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">60</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">#          通用的帮助信息生成函数            #</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">61</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">##############################################</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">62</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">63</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">show_command_help</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">64</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">local</span><span style="--0:#E1E4E8;--1:#24292E"> cmd</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">$1</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">65</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">local</span><span style="--0:#E1E4E8;--1:#24292E"> info</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">COMMAND_MAP</span><span style="--0:#9ECBFF;--1:#032F62">[</span><span style="--0:#E1E4E8;--1:#24292E">$cmd</span><span style="--0:#9ECBFF;--1:#032F62">]}"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">66</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">67</div></div><div class="code"><span class="indent">  </span><span style="--0:#99A0A6;--1:#616972"># 1) 把所有 "::" 替换成一个不会在脚本中出现的分隔符，比如 '|'</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">68</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">info</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">info</span><span style="--0:#F97583;--1:#BF3441">//::/</span><span style="--0:#9ECBFF;--1:#032F62">|}"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">69</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">70</div></div><div class="code"><span class="indent">  </span><span style="--0:#99A0A6;--1:#616972"># 2) 这时才能安全地用 IFS='|' 来做分割</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">71</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">local</span><span style="--0:#E1E4E8;--1:#24292E"> desc handler options_str</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">72</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">IFS</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"|"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">read</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-r</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">desc</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">handler</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">options_str</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">$info</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">73</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">74</div></div><div class="code"><span class="indent">  </span><span style="--0:#79B8FF;--1:#005CC5">echo</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-e</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#9ECBFF;--1:#032F62">}命令: ${</span><span style="--0:#E1E4E8;--1:#24292E">GREEN</span><span style="--0:#9ECBFF;--1:#032F62">}</span><span style="--0:#E1E4E8;--1:#24292E">$cmd</span><span style="--0:#9ECBFF;--1:#032F62">${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">}"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">75</div></div><div class="code"><span class="indent">  </span><span style="--0:#79B8FF;--1:#005CC5">echo</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-e</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#9ECBFF;--1:#032F62">}描述: ${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">}</span><span style="--0:#E1E4E8;--1:#24292E">$desc</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">76</div></div><div class="code"><span class="indent">  </span><span style="--0:#79B8FF;--1:#005CC5">echo</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-e</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#9ECBFF;--1:#032F62">}选项:${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">}"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">77</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">78</div></div><div class="code"><span class="indent">  </span><span style="--0:#99A0A6;--1:#616972"># 3) 选项声明里可能有多段「::」分隔，继续替换并拆分</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">79</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">options_str</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">options_str</span><span style="--0:#F97583;--1:#BF3441">//::/</span><span style="--0:#9ECBFF;--1:#032F62">|}"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">80</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">IFS</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"|"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">read</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-ra</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">opt_lines</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">$options_str</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">81</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">82</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> opt_line </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">opt_lines</span><span style="--0:#9ECBFF;--1:#032F62">[</span><span style="--0:#F97583;--1:#BF3441">@</span><span style="--0:#9ECBFF;--1:#032F62">]}"</span><span style="--0:#E1E4E8;--1:#24292E">; </span><span style="--0:#F97583;--1:#BF3441">do</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">83</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">[[ </span><span style="--0:#F97583;--1:#BF3441">-z</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">$opt_line</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E"> ]] &#x26;&#x26; </span><span style="--0:#F97583;--1:#BF3441">continue</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">84</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">85</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># opt_line 类似 "-p,--package:指定包名（必须）"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">86</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 用 ":" 分割出（短+长选项）和描述</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">87</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">IFS</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">":"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">read</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-r</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">flags</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">desc</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">$opt_line</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">88</div></div><div class="code"><span class="indent">    </span><span style="--0:#79B8FF;--1:#005CC5">printf</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"  ${</span><span style="--0:#E1E4E8;--1:#24292E">GREEN</span><span style="--0:#9ECBFF;--1:#032F62">}%-20s${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">} %s\n"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">$flags</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">$desc</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">89</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">done</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">90</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">91</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">92</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 主帮助信息</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">93</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">show_help</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">94</div></div><div class="code"><span class="indent">  </span><span style="--0:#79B8FF;--1:#005CC5">echo</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-e</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#9ECBFF;--1:#032F62">}使用方法:${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">}"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">95</div></div><div class="code"><span class="indent">  </span><span style="--0:#79B8FF;--1:#005CC5">echo</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"  </span><span style="--0:#79B8FF;--1:#005CC5">$0</span><span style="--0:#9ECBFF;--1:#032F62"> [命令] [选项]"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">96</div></div><div class="code"><span class="indent">  </span><span style="--0:#79B8FF;--1:#005CC5">echo</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">97</div></div><div class="code"><span class="indent">  </span><span style="--0:#79B8FF;--1:#005CC5">echo</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-e</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#9ECBFF;--1:#032F62">}可用命令:${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">}"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">98</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> cmd </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#F97583;--1:#BF3441">!</span><span style="--0:#E1E4E8;--1:#24292E">COMMAND_MAP</span><span style="--0:#9ECBFF;--1:#032F62">[</span><span style="--0:#F97583;--1:#BF3441">@</span><span style="--0:#9ECBFF;--1:#032F62">]}"</span><span style="--0:#E1E4E8;--1:#24292E">; </span><span style="--0:#F97583;--1:#BF3441">do</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">99</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">local</span><span style="--0:#E1E4E8;--1:#24292E"> desc</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">${COMMAND_MAP[$cmd]</span><span style="--0:#F97583;--1:#BF3441">%%::*</span><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">100</div></div><div class="code"><span class="indent">    </span><span style="--0:#79B8FF;--1:#005CC5">printf</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"  ${</span><span style="--0:#E1E4E8;--1:#24292E">GREEN</span><span style="--0:#9ECBFF;--1:#032F62">}%-15s${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">} %s\n"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">$cmd</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">$desc</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">101</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">done</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">102</div></div><div class="code"><span class="indent">  </span><span style="--0:#79B8FF;--1:#005CC5">echo</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-e</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"\n使用 ${</span><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#9ECBFF;--1:#032F62">}</span><span style="--0:#79B8FF;--1:#005CC5">$0</span><span style="--0:#9ECBFF;--1:#032F62"> 命令 --help${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">} 查看具体命令帮助"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">103</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">104</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">105</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">##############################################</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">106</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">#               命令处理函数                 #</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">107</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">##############################################</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">108</div></div><div class="code">
</div></div><div class="ec-line highlight mark"><div class="gutter"><div class="ln">109</div></div><div class="code"><span style="--0:#c2a8f3;--1:#613aa9">handle_install</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">110</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">local</span><span style="--0:#E1E4E8;--1:#24292E"> package</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">""</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">111</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">while</span><span style="--0:#E1E4E8;--1:#24292E"> [[ </span><span style="--0:#79B8FF;--1:#005CC5">$#</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">-gt</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E"> ]]; </span><span style="--0:#F97583;--1:#BF3441">do</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">112</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">case</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#AE4B07">$1</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">in</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">113</div></div><div class="code"><span class="indent">      </span><span style="--0:#DBEDFF;--1:#032F62">-p</span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#DBEDFF;--1:#032F62">--package</span><span style="--0:#F97583;--1:#BF3441">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">114</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">package</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">$2</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">115</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">shift</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">2</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">116</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">117</div></div><div class="code"><span class="indent">      </span><span style="--0:#DBEDFF;--1:#032F62">-h</span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#DBEDFF;--1:#032F62">--help</span><span style="--0:#F97583;--1:#BF3441">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">118</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">show_command_help</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"install"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">119</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">exit</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">120</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">121</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">*)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">122</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">panic</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"未知选项: </span><span style="--0:#79B8FF;--1:#005CC5">$1</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">123</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">124</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">esac</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">125</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">done</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">126</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">[[ </span><span style="--0:#F97583;--1:#BF3441">-z</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">$package</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E"> ]] &#x26;&#x26; </span><span style="--0:#B392F0;--1:#6F42C1">panic</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"必须指定包名"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">127</div></div><div class="code"><span class="indent">  </span><span style="--0:#B392F0;--1:#6F42C1">log_success</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"正在安装 ${</span><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#9ECBFF;--1:#032F62">}</span><span style="--0:#E1E4E8;--1:#24292E">$package</span><span style="--0:#9ECBFF;--1:#032F62">${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">}"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">128</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">129</div></div><div class="code">
</div></div><div class="ec-line highlight mark"><div class="gutter"><div class="ln">130</div></div><div class="code"><span style="--0:#c2a8f3;--1:#613aa9">handle_remove</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">131</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">local</span><span style="--0:#E1E4E8;--1:#24292E"> package</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">""</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">132</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">while</span><span style="--0:#E1E4E8;--1:#24292E"> [[ </span><span style="--0:#79B8FF;--1:#005CC5">$#</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">-gt</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E"> ]]; </span><span style="--0:#F97583;--1:#BF3441">do</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">133</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">case</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#AE4B07">$1</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">in</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">134</div></div><div class="code"><span class="indent">      </span><span style="--0:#DBEDFF;--1:#032F62">-p</span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#DBEDFF;--1:#032F62">--package</span><span style="--0:#F97583;--1:#BF3441">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">135</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">package</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">$2</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">136</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">shift</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">2</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">137</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">138</div></div><div class="code"><span class="indent">      </span><span style="--0:#DBEDFF;--1:#032F62">-h</span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#DBEDFF;--1:#032F62">--help</span><span style="--0:#F97583;--1:#BF3441">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">139</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">show_command_help</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"remove"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">140</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">exit</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">141</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">142</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">*)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">143</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">panic</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"未知选项: </span><span style="--0:#79B8FF;--1:#005CC5">$1</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">144</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">145</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">esac</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">146</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">done</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">147</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">[[ </span><span style="--0:#F97583;--1:#BF3441">-z</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">$package</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E"> ]] &#x26;&#x26; </span><span style="--0:#B392F0;--1:#6F42C1">panic</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"必须指定包名"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">148</div></div><div class="code"><span class="indent">  </span><span style="--0:#B392F0;--1:#6F42C1">log_success</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"正在移除 ${</span><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#9ECBFF;--1:#032F62">}</span><span style="--0:#E1E4E8;--1:#24292E">$package</span><span style="--0:#9ECBFF;--1:#032F62">${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">}"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">149</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">150</div></div><div class="code">
</div></div><div class="ec-line highlight mark"><div class="gutter"><div class="ln">151</div></div><div class="code"><span style="--0:#c2a8f3;--1:#613aa9">handle_backup</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">152</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">local</span><span style="--0:#E1E4E8;--1:#24292E"> src</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">""</span><span style="--0:#E1E4E8;--1:#24292E"> dest</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"/backups"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">153</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">while</span><span style="--0:#E1E4E8;--1:#24292E"> [[ </span><span style="--0:#79B8FF;--1:#005CC5">$#</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">-gt</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E"> ]]; </span><span style="--0:#F97583;--1:#BF3441">do</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">154</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">case</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#AE4B07">$1</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">in</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">155</div></div><div class="code"><span class="indent">      </span><span style="--0:#DBEDFF;--1:#032F62">-s</span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#DBEDFF;--1:#032F62">--src</span><span style="--0:#F97583;--1:#BF3441">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">156</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">src</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">$2</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">157</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">shift</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">2</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">158</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">159</div></div><div class="code"><span class="indent">      </span><span style="--0:#DBEDFF;--1:#032F62">-d</span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#DBEDFF;--1:#032F62">--dest</span><span style="--0:#F97583;--1:#BF3441">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">160</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">dest</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">$2</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">161</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">shift</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">2</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">162</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">163</div></div><div class="code"><span class="indent">      </span><span style="--0:#DBEDFF;--1:#032F62">-h</span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#DBEDFF;--1:#032F62">--help</span><span style="--0:#F97583;--1:#BF3441">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">164</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">show_command_help</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"backup"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">165</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">exit</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">166</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">167</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">*)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">168</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">panic</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"未知选项: </span><span style="--0:#79B8FF;--1:#005CC5">$1</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">169</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">170</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">esac</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">171</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">done</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">172</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">[[ </span><span style="--0:#F97583;--1:#BF3441">-z</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">$src</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E"> ]] &#x26;&#x26; </span><span style="--0:#B392F0;--1:#6F42C1">panic</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"必须指定源目录"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">173</div></div><div class="code"><span class="indent">  </span><span style="--0:#B392F0;--1:#6F42C1">log_info</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"从 ${</span><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#9ECBFF;--1:#032F62">}</span><span style="--0:#E1E4E8;--1:#24292E">$src</span><span style="--0:#9ECBFF;--1:#032F62">${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">} 备份到 ${</span><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#9ECBFF;--1:#032F62">}</span><span style="--0:#E1E4E8;--1:#24292E">$dest</span><span style="--0:#9ECBFF;--1:#032F62">${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">}"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">174</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">175</div></div><div class="code"><span class="indent">  </span><span style="--0:#99A0A6;--1:#616972"># 示范如何安全处理包含空格的文件名</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">176</div></div><div class="code"><span class="indent">  </span><span style="--0:#B392F0;--1:#6F42C1">log_info</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"搜索文件..."</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">177</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">local</span><span style="--0:#E1E4E8;--1:#24292E"> count</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#79B8FF;--1:#005CC5">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">178</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">179</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">while</span><span style="--0:#E1E4E8;--1:#24292E"> IFS</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">read</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-r</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-d</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">''</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">file</span><span style="--0:#E1E4E8;--1:#24292E">; </span><span style="--0:#F97583;--1:#BF3441">do</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">180</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">    </span></span><span style="--0:#E1E4E8;--1:#24292E">((count</span><span style="--0:#F97583;--1:#BF3441">++</span><span style="--0:#E1E4E8;--1:#24292E">))</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">181</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">log_info</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"处理文件: ${</span><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#9ECBFF;--1:#032F62">}</span><span style="--0:#E1E4E8;--1:#24292E">$file</span><span style="--0:#9ECBFF;--1:#032F62">${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">}"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">182</div></div><div class="code"><span class="indent">    </span><span style="--0:#99A0A6;--1:#616972"># 这里放实际的处理逻辑</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">183</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">done</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">&#x3C;(</span><span style="--0:#B392F0;--1:#6F42C1">find</span><span style="--0:#9ECBFF;--1:#032F62"> "</span><span style="--0:#E1E4E8;--1:#24292E">$src</span><span style="--0:#9ECBFF;--1:#032F62">" </span><span style="--0:#79B8FF;--1:#005CC5">-type</span><span style="--0:#9ECBFF;--1:#032F62"> f </span><span style="--0:#79B8FF;--1:#005CC5">-print0</span><span style="--0:#9ECBFF;--1:#032F62">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">184</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">185</div></div><div class="code"><span class="indent">  </span><span style="--0:#B392F0;--1:#6F42C1">log_success</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"共处理了 ${</span><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#9ECBFF;--1:#032F62">}</span><span style="--0:#E1E4E8;--1:#24292E">$count</span><span style="--0:#9ECBFF;--1:#032F62">${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">} 个文件"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">186</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">187</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">188</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">##############################################</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">189</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">#                 主逻辑                     #</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">190</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972">##############################################</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">191</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">192</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">main</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">193</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">[[ </span><span style="--0:#79B8FF;--1:#005CC5">$#</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">-eq</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E"> ]] </span><span style="--0:#F97583;--1:#BF3441">||</span><span style="--0:#E1E4E8;--1:#24292E"> [[ </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">$1</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"--help"</span><span style="--0:#E1E4E8;--1:#24292E"> ]] &#x26;&#x26; </span><span style="--0:#B392F0;--1:#6F42C1">show_help</span><span style="--0:#E1E4E8;--1:#24292E"> &#x26;&#x26; </span><span style="--0:#79B8FF;--1:#005CC5">exit</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">194</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">195</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">local</span><span style="--0:#E1E4E8;--1:#24292E"> cmd</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">$1</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">196</div></div><div class="code"><span class="indent">  </span><span style="--0:#79B8FF;--1:#005CC5">shift</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">197</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">198</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">[[ </span><span style="--0:#F97583;--1:#BF3441">-n</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">COMMAND_MAP</span><span style="--0:#9ECBFF;--1:#032F62">[</span><span style="--0:#E1E4E8;--1:#24292E">$cmd</span><span style="--0:#9ECBFF;--1:#032F62">]}"</span><span style="--0:#E1E4E8;--1:#24292E"> ]] </span><span style="--0:#F97583;--1:#BF3441">||</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#B392F0;--1:#6F42C1">panic</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"未知命令: </span><span style="--0:#E1E4E8;--1:#24292E">$cmd</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">199</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">200</div></div><div class="code"><span class="indent">  </span><span style="--0:#99A0A6;--1:#616972"># 同样地，这里也要避免直接 IFS="::" 分割</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">201</div></div><div class="code"><span class="indent">  </span><span style="--0:#99A0A6;--1:#616972"># 先用 '|' 替换 "::" ，再做一次分割即可</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">202</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">local</span><span style="--0:#E1E4E8;--1:#24292E"> info</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">COMMAND_MAP</span><span style="--0:#9ECBFF;--1:#032F62">[</span><span style="--0:#E1E4E8;--1:#24292E">$cmd</span><span style="--0:#9ECBFF;--1:#032F62">]}"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">203</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">info</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">info</span><span style="--0:#F97583;--1:#BF3441">//::/</span><span style="--0:#9ECBFF;--1:#032F62">|}"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">204</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">205</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">local</span><span style="--0:#E1E4E8;--1:#24292E"> desc handler options_str</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">206</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">IFS</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">"|"</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">read</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-r</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">desc</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">handler</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">options_str</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">&#x3C;&#x3C;&#x3C;</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">$info</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">207</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">208</div></div><div class="code"><span class="indent">  </span><span style="--0:#99A0A6;--1:#616972"># 调用对应的处理函数</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">209</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">$handler </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">$@</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">210</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">211</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">212</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">main</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">$@</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div></details></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#!/usr/bin/env bash#!/usr/bin/env bash#==================================================================# ██╗  ██╗   ██╗███╗   ██╗██████╗ ██████╗  █████╗# ██║  ╚██╗ ██╔╝████╗  ██║██╔══██╗██╔══██╗██╔══██╗# ██║   ╚████╔╝ ██╔██╗ ██║██║  ██║██████╔╝███████║# ██║    ╚██╔╝  ██║╚██╗██║██║  ██║██╔══██╗██╔══██║# ███████╗██║   ██║ ╚████║██████╔╝██║  ██║██║  ██║# ╚══════╝╚═╝   ╚═╝  ╚═══╝╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝#==================================================================## 文件名称: 脚本模板.sh# 文件描述: 一个通用的 Shell 脚本模板，提供命令行参数处理、日志输出等基础功能## 作者: Lyndra <lyndra.hyst@gmail.com># 版本: 1.0.0# 创建日期: 2025-02-28# 最后修改: 2025-02-28## 使用许可: GPLv2 or other licenses# Copyright (c) 2025 Lyndra##==================================================================set -eo pipefail# 颜色配置RED=&#x27;\033[0;31m&#x27;GREEN=&#x27;\033[0;32m&#x27;YELLOW=&#x27;\033[1;33m&#x27;NC=&#x27;\033[0m&#x27;# 命令配置，格式为：[命令名]=&#x22;描述::处理函数::选项声明1::选项声明2::...&#x22;declare -A COMMAND_MAP=(  [&#x22;install&#x22;]=&#x22;安装软件包::handle_install::-p,--package:指定包名（必须）&#x22;  [&#x22;remove&#x22;]=&#x22;移除软件包::handle_remove::-p,--package:指定包名（必须）&#x22;  [&#x22;backup&#x22;]=&#x22;执行备份::handle_backup::-s,--src:源目录（必须）::-d,--dest:目标目录（默认：/backups）&#x22;)# 错误处理函数panic() {  echo -e &#x22;${RED}[错误]${NC} $1&#x22; >&#x26;2  exit 1}# 日志输出函数log_info() {  echo -e &#x22;${GREEN}[信息]${NC} $1&#x22; >&#x26;2}log_warning() {  echo -e &#x22;${YELLOW}[警告]${NC} $1&#x22; >&#x26;2}log_success() {  echo -e &#x22;${GREEN}[成功]${NC} $1&#x22; >&#x26;2}###############################################          通用的帮助信息生成函数            ###############################################show_command_help() {  local cmd=&#x22;$1&#x22;  local info=&#x22;${COMMAND_MAP[$cmd]}&#x22;  # 1) 把所有 &#x22;::&#x22; 替换成一个不会在脚本中出现的分隔符，比如 &#x27;|&#x27;  info=&#x22;${info//::/|}&#x22;  # 2) 这时才能安全地用 IFS=&#x27;|&#x27; 来做分割  local desc handler options_str  IFS=&#x22;|&#x22; read -r desc handler options_str <<< &#x22;$info&#x22;  echo -e &#x22;${YELLOW}命令: ${GREEN}$cmd${NC}&#x22;  echo -e &#x22;${YELLOW}描述: ${NC}$desc&#x22;  echo -e &#x22;${YELLOW}选项:${NC}&#x22;  # 3) 选项声明里可能有多段「::」分隔，继续替换并拆分  options_str=&#x22;${options_str//::/|}&#x22;  IFS=&#x22;|&#x22; read -ra opt_lines <<< &#x22;$options_str&#x22;  for opt_line in &#x22;${opt_lines[@]}&#x22;; do    [[ -z &#x22;$opt_line&#x22; ]] &#x26;&#x26; continue    # opt_line 类似 &#x22;-p,--package:指定包名（必须）&#x22;    # 用 &#x22;:&#x22; 分割出（短+长选项）和描述    IFS=&#x22;:&#x22; read -r flags desc <<< &#x22;$opt_line&#x22;    printf &#x22;  ${GREEN}%-20s${NC} %s\n&#x22; &#x22;$flags&#x22; &#x22;$desc&#x22;  done}# 主帮助信息show_help() {  echo -e &#x22;${YELLOW}使用方法:${NC}&#x22;  echo &#x22;  $0 [命令] [选项]&#x22;  echo  echo -e &#x22;${YELLOW}可用命令:${NC}&#x22;  for cmd in &#x22;${!COMMAND_MAP[@]}&#x22;; do    local desc=${COMMAND_MAP[$cmd]%%::*}    printf &#x22;  ${GREEN}%-15s${NC} %s\n&#x22; &#x22;$cmd&#x22; &#x22;$desc&#x22;  done  echo -e &#x22;\n使用 ${YELLOW}$0 命令 --help${NC} 查看具体命令帮助&#x22;}###############################################               命令处理函数                 ###############################################handle_install() {  local package=&#x22;&#x22;  while [[ $# -gt 0 ]]; do    case $1 in      -p|--package)        package=&#x22;$2&#x22;        shift 2        ;;      -h|--help)        show_command_help &#x22;install&#x22;        exit 0        ;;      *)        panic &#x22;未知选项: $1&#x22;        ;;    esac  done  [[ -z &#x22;$package&#x22; ]] &#x26;&#x26; panic &#x22;必须指定包名&#x22;  log_success &#x22;正在安装 ${YELLOW}$package${NC}&#x22;}handle_remove() {  local package=&#x22;&#x22;  while [[ $# -gt 0 ]]; do    case $1 in      -p|--package)        package=&#x22;$2&#x22;        shift 2        ;;      -h|--help)        show_command_help &#x22;remove&#x22;        exit 0        ;;      *)        panic &#x22;未知选项: $1&#x22;        ;;    esac  done  [[ -z &#x22;$package&#x22; ]] &#x26;&#x26; panic &#x22;必须指定包名&#x22;  log_success &#x22;正在移除 ${YELLOW}$package${NC}&#x22;}handle_backup() {  local src=&#x22;&#x22; dest=&#x22;/backups&#x22;  while [[ $# -gt 0 ]]; do    case $1 in      -s|--src)        src=&#x22;$2&#x22;        shift 2        ;;      -d|--dest)        dest=&#x22;$2&#x22;        shift 2        ;;      -h|--help)        show_command_help &#x22;backup&#x22;        exit 0        ;;      *)        panic &#x22;未知选项: $1&#x22;        ;;    esac  done  [[ -z &#x22;$src&#x22; ]] &#x26;&#x26; panic &#x22;必须指定源目录&#x22;  log_info &#x22;从 ${YELLOW}$src${NC} 备份到 ${YELLOW}$dest${NC}&#x22;  # 示范如何安全处理包含空格的文件名  log_info &#x22;搜索文件...&#x22;  local count=0  while IFS= read -r -d &#x27;&#x27; file; do    ((count++))    log_info &#x22;处理文件: ${YELLOW}$file${NC}&#x22;    # 这里放实际的处理逻辑  done < <(find &#x22;$src&#x22; -type f -print0)  log_success &#x22;共处理了 ${YELLOW}$count${NC} 个文件&#x22;}###############################################                 主逻辑                     ###############################################main() {  [[ $# -eq 0 ]] || [[ &#x22;$1&#x22; == &#x22;--help&#x22; ]] &#x26;&#x26; show_help &#x26;&#x26; exit 0  local cmd=&#x22;$1&#x22;  shift  [[ -n &#x22;${COMMAND_MAP[$cmd]}&#x22; ]] || panic &#x22;未知命令: $cmd&#x22;  # 同样地，这里也要避免直接 IFS=&#x22;::&#x22; 分割  # 先用 &#x27;|&#x27; 替换 &#x22;::&#x22; ，再做一次分割即可  local info=&#x22;${COMMAND_MAP[$cmd]}&#x22;  info=&#x22;${info//::/|}&#x22;  local desc handler options_str  IFS=&#x22;|&#x22; read -r desc handler options_str <<< &#x22;$info&#x22;  # 调用对应的处理函数  $handler &#x22;$@&#x22;}main &#x22;$@&#x22;"><div></div></button></div></figure></div>
<h2 id="使用方式">使用方式</h2>
<p>在命令行中输入 <code>./Shell_script_template.sh</code> 即可看到帮助信息。命令行参数分为命令、选项。</p>
<p>命令是脚本的功能，比如 <code>install</code>、<code>remove</code>、<code>backup</code> 等。</p>
<p>选项是命令支持的参数，比如 <code>-p,--package</code> 表示包名。每一个选项可以传入多种不同类型的输入参数，由该选项自主解析。</p>
<p>例如：</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="gutter"><div class="ln">1</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">./Shell_script_template.sh</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">install</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-p</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">package_name</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="./Shell_script_template.sh install -p package_name"><div></div></button></div></figure></div>
<h2 id="基于模板开发脚本">基于模板开发脚本</h2>
<p>基于这个脚本模板开发新脚本时，只需要在 <code>COMMAND_MAP</code> 中添加新的命令，并实现对应的处理函数即可。</p>
<p><code>COMMAND_MAP</code> 的命令配置格式为：<code>[命令名]="描述::处理函数::选项声明1::选项声明2::..."</code>。其中 <code>选项声明</code> 的格式为：<code>-短选项,--长选项:描述</code>。</p>
<p>参数的解析由每一个选项的处理函数来完成。可以处理多个参数，或者不处理参数。</p>
<h3 id="处理多参数选项">处理多参数选项</h3>
<p>对于需要接收多个参数的选项，可以通过数组来收集参数。下面是一个示例：</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="gutter"><div class="ln">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 在 COMMAND_MAP 中添加新命令</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">2</div></div><div class="code"><span style="--0:#F97583;--1:#BF3441">declare</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-A</span><span style="--0:#E1E4E8;--1:#24292E"> COMMAND_MAP</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">(</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">3</div></div><div class="code"><span class="indent">  </span><span style="--0:#99A0A6;--1:#616972"># ... 其他命令 ...</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">4</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">[</span><span style="--0:#B392F0;--1:#6F42C1">"compile"</span><span style="--0:#E1E4E8;--1:#24292E">]=</span><span style="--0:#9ECBFF;--1:#032F62">"编译源文件::handle_compile::-s,--src:源文件列表::-d,--debug:启用调试"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">5</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">7</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 处理函数示例</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">8</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">handle_compile</span><span style="--0:#E1E4E8;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">9</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">local</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">-a</span><span style="--0:#E1E4E8;--1:#24292E"> source_files</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">()  </span><span style="--0:#99A0A6;--1:#616972"># 定义数组保存源文件</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">10</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">local</span><span style="--0:#E1E4E8;--1:#24292E"> debug</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#E1E4E8;--1:#24292E">false</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">11</div></div><div class="code">
</div></div><div class="ec-line highlight mark"><div class="gutter"><div class="ln">12</div></div><div class="code"><span class="indent">  </span><span style="--0:#fb99a3;--1:#982934">while</span><span style="--0:#E1E4E8;--1:#24292E"> [[ </span><span style="--0:#79B8FF;--1:#004fa9">$#</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#fb99a3;--1:#982934">-gt</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#004fa9">0</span><span style="--0:#E1E4E8;--1:#24292E"> ]]; </span><span style="--0:#fb99a3;--1:#982934">do</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">13</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">case</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#AE4B07">$1</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#F97583;--1:#BF3441">in</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">14</div></div><div class="code"><span class="indent">      </span><span style="--0:#DBEDFF;--1:#032F62">-s</span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#DBEDFF;--1:#032F62">--src</span><span style="--0:#F97583;--1:#BF3441">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">15</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">shift</span><span style="--0:#E1E4E8;--1:#24292E">  </span><span style="--0:#99A0A6;--1:#616972"># 移除 --src 选项</span></div></div><details class="ec-section"><summary><div class="ec-line"><div class="gutter"><div class="ln"></div></div><div class="code"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="0 0 16 16" width="16" height="16"><path d="m8.177.677 2.896 2.896a.25.25 0 0 1-.177.427H8.75v1.25a.75.75 0 0 1-1.5 0V4H5.104a.25.25 0 0 1-.177-.427L7.823.677a.25.25 0 0 1 .354 0ZM7.25 10.75a.75.75 0 0 1 1.5 0V12h2.146a.25.25 0 0 1 .177.427l-2.896 2.896a.25.25 0 0 1-.354 0l-2.896-2.896A.25.25 0 0 1 5.104 12H7.25v-1.25Zm-5-2a.75.75 0 0 0 0-1.5h-.5a.75.75 0 0 0 0 1.5h.5ZM6 8a.75.75 0 0 1-.75.75h-.5a.75.75 0 0 1 0-1.5h.5A.75.75 0 0 1 6 8Zm2.25.75a.75.75 0 0 0 0-1.5h-.5a.75.75 0 0 0 0 1.5h.5ZM12 8a.75.75 0 0 1-.75.75h-.5a.75.75 0 0 1 0-1.5h.5A.75.75 0 0 1 12 8Zm2.25.75a.75.75 0 0 0 0-1.5h-.5a.75.75 0 0 0 0 1.5h.5Z"></path></svg>36 collapsed lines</div></div></summary><div class="ec-line"><div class="gutter"><div class="ln">16</div></div><div class="code"><span class="indent">        </span><span style="--0:#99A0A6;--1:#616972"># 收集所有不以 - 开头的参数作为源文件</span></div></div><div class="ec-line highlight mark"><div class="gutter"><div class="ln">17</div></div><div class="code"><span class="indent">        </span><span style="--0:#fb99a3;--1:#982934">while</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">[[</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#004fa9">$#</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#004fa9">-gt</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#004fa9">0</span><span style="--0:#E1E4E8;--1:#24292E"> &#x26;&#x26; </span><span style="--0:#fb99a3;--1:#982934">!</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#FFAB70;--1:#8b3c06">$1</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">=~</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">^-</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">]]</span><span style="--0:#E1E4E8;--1:#24292E">; </span><span style="--0:#fb99a3;--1:#982934">do</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">18</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">          </span></span><span style="--0:#E1E4E8;--1:#24292E">source_files</span><span style="--0:#F97583;--1:#BF3441">+=</span><span style="--0:#E1E4E8;--1:#24292E">(</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#79B8FF;--1:#005CC5">$1</span><span style="--0:#9ECBFF;--1:#032F62">"</span><span style="--0:#E1E4E8;--1:#24292E">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">19</div></div><div class="code"><span class="indent">          </span><span style="--0:#79B8FF;--1:#005CC5">shift</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">20</div></div><div class="code"><span class="indent">        </span><span style="--0:#F97583;--1:#BF3441">done</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">21</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">22</div></div><div class="code"><span class="indent">      </span><span style="--0:#DBEDFF;--1:#032F62">-d</span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#DBEDFF;--1:#032F62">--debug</span><span style="--0:#F97583;--1:#BF3441">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">23</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">debug</span><span style="--0:#F97583;--1:#BF3441">=</span><span style="--0:#9ECBFF;--1:#032F62">true</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">24</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">shift</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">25</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">26</div></div><div class="code"><span class="indent">      </span><span style="--0:#DBEDFF;--1:#032F62">-h</span><span style="--0:#F97583;--1:#BF3441">|</span><span style="--0:#DBEDFF;--1:#032F62">--help</span><span style="--0:#F97583;--1:#BF3441">)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">27</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">show_command_help</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"compile"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">28</div></div><div class="code"><span class="indent">        </span><span style="--0:#79B8FF;--1:#005CC5">exit</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">29</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">30</div></div><div class="code"><span class="indent">      </span><span style="--0:#F97583;--1:#BF3441">*)</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">31</div></div><div class="code"><span class="indent">        </span><span style="--0:#B392F0;--1:#6F42C1">panic</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"未知选项: </span><span style="--0:#79B8FF;--1:#005CC5">$1</span><span style="--0:#9ECBFF;--1:#032F62">"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">32</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">        </span></span><span style="--0:#E1E4E8;--1:#24292E">;;</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">33</div></div><div class="code"><span class="indent">    </span><span style="--0:#F97583;--1:#BF3441">esac</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">34</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">done</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">35</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">36</div></div><div class="code"><span class="indent">  </span><span style="--0:#99A0A6;--1:#616972"># 检查是否提供了源文件</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">37</div></div><div class="code"><span class="indent"><span style="--0:#E1E4E8;--1:#24292E">  </span></span><span style="--0:#E1E4E8;--1:#24292E">[[ ${</span><span style="--0:#F97583;--1:#BF3441">#</span><span style="--0:#E1E4E8;--1:#24292E">source_files[</span><span style="--0:#F97583;--1:#BF3441">@</span><span style="--0:#E1E4E8;--1:#24292E">]} </span><span style="--0:#F97583;--1:#BF3441">-eq</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">0</span><span style="--0:#E1E4E8;--1:#24292E"> ]] &#x26;&#x26; </span><span style="--0:#B392F0;--1:#6F42C1">panic</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"必须指定至少一个源文件"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">38</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">39</div></div><div class="code"><span class="indent">  </span><span style="--0:#99A0A6;--1:#616972"># 显示编译信息</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">40</div></div><div class="code"><span class="indent">  </span><span style="--0:#B392F0;--1:#6F42C1">log_info</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"准备编译以下文件:"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">41</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">for</span><span style="--0:#E1E4E8;--1:#24292E"> src </span><span style="--0:#F97583;--1:#BF3441">in</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"${</span><span style="--0:#E1E4E8;--1:#24292E">source_files</span><span style="--0:#9ECBFF;--1:#032F62">[</span><span style="--0:#F97583;--1:#BF3441">@</span><span style="--0:#9ECBFF;--1:#032F62">]}"</span><span style="--0:#E1E4E8;--1:#24292E">; </span><span style="--0:#F97583;--1:#BF3441">do</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">42</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">log_info</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"- ${</span><span style="--0:#E1E4E8;--1:#24292E">YELLOW</span><span style="--0:#9ECBFF;--1:#032F62">}</span><span style="--0:#E1E4E8;--1:#24292E">$src</span><span style="--0:#9ECBFF;--1:#032F62">${</span><span style="--0:#E1E4E8;--1:#24292E">NC</span><span style="--0:#9ECBFF;--1:#032F62">}"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">43</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">done</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">44</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">45</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">if</span><span style="--0:#E1E4E8;--1:#24292E"> [[ $debug </span><span style="--0:#F97583;--1:#BF3441">==</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">true</span><span style="--0:#E1E4E8;--1:#24292E"> ]]; </span><span style="--0:#F97583;--1:#BF3441">then</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">46</div></div><div class="code"><span class="indent">    </span><span style="--0:#B392F0;--1:#6F42C1">log_info</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"调试模式已启用"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">47</div></div><div class="code"><span class="indent">  </span><span style="--0:#F97583;--1:#BF3441">fi</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">48</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">49</div></div><div class="code"><span class="indent">  </span><span style="--0:#99A0A6;--1:#616972"># 这里添加实际的编译逻辑</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">50</div></div><div class="code"><span class="indent">  </span><span style="--0:#B392F0;--1:#6F42C1">log_success</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">"编译完成"</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">51</div></div><div class="code"><span style="--0:#E1E4E8;--1:#24292E">}</span></div></div></details></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="declare -A COMMAND_MAP=(  [&#x22;compile&#x22;]=&#x22;编译源文件::handle_compile::-s,--src:源文件列表::-d,--debug:启用调试&#x22;)handle_compile() {  local -a source_files=()  # 定义数组保存源文件  local debug=false  while [[ $# -gt 0 ]]; do    case $1 in      -s|--src)        shift  # 移除 --src 选项        while [[ $# -gt 0 &#x26;&#x26; ! $1 =~ ^- ]]; do          source_files+=(&#x22;$1&#x22;)          shift        done        ;;      -d|--debug)        debug=true        shift        ;;      -h|--help)        show_command_help &#x22;compile&#x22;        exit 0        ;;      *)        panic &#x22;未知选项: $1&#x22;        ;;    esac  done  [[ ${#source_files[@]} -eq 0 ]] &#x26;&#x26; panic &#x22;必须指定至少一个源文件&#x22;  log_info &#x22;准备编译以下文件:&#x22;  for src in &#x22;${source_files[@]}&#x22;; do    log_info &#x22;- ${YELLOW}$src${NC}&#x22;  done  if [[ $debug == true ]]; then    log_info &#x22;调试模式已启用&#x22;  fi  log_success &#x22;编译完成&#x22;}"><div></div></button></div></figure></div>
<p>使用示例：</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="gutter"><div class="ln">1</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 编译多个源文件</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">2</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">./build.sh</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">compile</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">--src</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">file1.c</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">file2.c</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">file3.c</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">3</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">4</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 启用调试模式编译</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">5</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">./build.sh</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">compile</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">--src</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">main.c</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">utils.c</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">--debug</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">6</div></div><div class="code">
</div></div><div class="ec-line"><div class="gutter"><div class="ln">7</div></div><div class="code"><span style="--0:#99A0A6;--1:#616972"># 查看帮助</span></div></div><div class="ec-line"><div class="gutter"><div class="ln">8</div></div><div class="code"><span style="--0:#B392F0;--1:#6F42C1">./build.sh</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#9ECBFF;--1:#032F62">compile</span><span style="--0:#E1E4E8;--1:#24292E"> </span><span style="--0:#79B8FF;--1:#005CC5">--help</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="./build.sh compile --src file1.c file2.c file3.c./build.sh compile --src main.c utils.c --debug./build.sh compile --help"><div></div></button></div></figure></div>
<p>关键点说明：</p>
<ol>
<li>使用数组 <code>local -a source_files=()</code> 来存储多个参数</li>
<li>通过 <code>while</code> 循环收集连续的非选项参数</li>
<li>使用 <code>! $1 =~ ^-</code> 判断参数是否以 <code>-</code> 开头来区分选项和参数</li>
<li>使用 <code>${#source_files[@]}</code> 获取数组长度</li>
<li>使用 <code>for</code> 循环遍历数组中的所有参数</li>
</ol>
<p>说明：</p>
<p>在 bash 中，符号 <code>=~</code> 表示通过正则表达式匹配。<code>$1 =~ ^-</code> 表示 <code>$1</code> 参数通过正则表达式 <code>^-</code> 匹配，并返回匹配结果。若 <code>$1</code> 参数以 <code>-</code> 开头，则返回 <code>true</code>，否则返回 <code>false</code>。</p> </article> <div class="divider-horizontal"></div> <div class="h-8 text-skin-base"> <a class="truncate  w-auto max-w-[40%] float-left" href="/blog/bash-语法" title="Bash 语法"> <i class="ri-arrow-left-s-fill"></i> Bash 语法 </a> <div class="flex item-center float-right w-auto max-w-[40%] text-right"> <a class="truncate " href="/blog/cursor-auto-free在linux下的操作教程" title="cursor-auto-free在Linux下的操作教程"> cursor-auto-free在Linux下的操作教程 </a> <i class="ri-arrow-right-s-fill float-right"></i> </div> </div> <div class="border-l-4 my-4 p-4 border-l-skin-base bg-skin-card break-all"> <div>本文标题：Shell 脚本模板</div> <div>文章作者：Lyndra</div> <div>发布时间：2025-02-28</div> <div> 原始链接：<a href="https://www.hysling.top/blog/shell-脚本模板" class="hover:text-skin-active">https://www.hysling.top/blog/shell-脚本模板</a> </div> </div>  </div>  <div class="giscus"></div> <script src="https://giscus.app/client.js" data-repo="codetang-2417/codetang-2417.github.io" data-repo-id="R_kgDOMyu4sg" data-category="Announcements" data-category-id="DIC_kwDOMyu4ss4CiiW6" data-mapping="title" data-strict="light" data-reactions-enabled="dark" data-emit-metadata="1" data-input-position="0" data-theme="light" data-lang="zh-CN" crossorigin="anonymous"></script> </div> <div class="hidden xl:block col-span-1 relative"> <div class="shadow-lg rounded-lg h-64 w-auto flex flex-col items-center justify-center bg-skin-card p-2"> <img class="avatar mb-4" src="/avatar.svg" alt="avatar"> <div class="mb-2 text-center">本来无一物，何处惹尘埃</div> <div class="flex items-center justify-center flex-wrap"> <a title="github" href="https://github.com/codetang-2417" target="_blank"> <i class="ri-github-fill text-2xl mr-2 cursor-pointer"></i> </a><a title="rss" href target="_blank"> <i class="ri-rss-fill text-2xl mr-2 cursor-pointer"></i> </a> </div> </div> <div id="toc" class="shadow-lg rounded-lg my-4 py-2 px-2 bg-skin-card sticky top-20" data-astro-cid-6t6zfk7k> <div class="aside-widget" data-astro-cid-6t6zfk7k> <i class="ri-list-check menu-icon" data-astro-cid-6t6zfk7k></i> 文章目录 </div> <div class="overflow-auto" data-astro-cid-6t6zfk7k> <div class="toc-container" data-astro-cid-6t6zfk7k></div> </div> </div>  <script type="module" src="/_astro/Toc.astro_astro_type_script_index_0_lang.R6DO86cs.js"></script> </div> <button type="button" id="scrollToTopBtn" class="header-btn fixed bottom-4 right-2 hidden" title="scroll to top"> <i class="ri-arrow-up-line"></i> </button> <script type="module">let o=document.getElementById("scrollToTopBtn");window.addEventListener("scroll",function(){window.scrollY>200?o.style.display="block":o.style.display="none"});o.addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})});</script> </div> <div class="h-16 container p-1 absolute left-0 bottom-0"> <div class="flex items-center justify-center text-skin-base"> <span id="busuanzi_container_site_pv"> 总访问量<span id="busuanzi_value_site_pv"></span>次 </span> <div class="divider-vertical"></div> <span id="busuanzi_container_site_uv"> 总访客数<span id="busuanzi_value_site_uv"></span>人次 </span> </div> <div class="flex items-center flex-col flex-wrap justify-center mb-4 text-skin-base first:mb-0 sm:flex-row"> <div> <span class="cursor-default">Copyright</span> <i class="ri-copyright-line align-middle"></i> <span class="align-middle">2025</span> </div>  <div class="divider-vertical"></div> <a href="/sitemap-0.xml">站点地图</a> </div> </div> </main> <script type="module" src="/_astro/BlogPost.astro_astro_type_script_index_0_lang.C_bBgou1.js"></script></body></html>